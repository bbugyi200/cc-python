#!/bin/bash

#################################################################################
# Check if this project is up-to-date with the cookiecutter that generated it.
#################################################################################

SCRIPTNAME="$(basename "$0")"

function run() {
    if [[ -n "${CC_REPO_URL}" ]]; then
        if [[ -f .cruft.json ]]; then
            perl -i -nE "print s{\"template\":.*}{\"${CC_REPO_URL}\",}gr" .cruft.json
        fi
    fi
    
    if ! cruft check --not-strict -c master; then
        if ! cruft check --not-strict -c stable; then
            echo "Your project is out of sync with the cookiecutter. Run 'make update-cc' to update your project."
            return 1
        fi
    fi
}

if [[ "${SCRIPTNAME}" == "$(basename "${BASH_SOURCE[0]}")" ]]; then
    run "$@"
fi
